{% extends "base.html" %}

{% block title %}Panel alarmu{% endblock %}

{% block content %}
  <h1 class="h4 mb-4">Panel systemu alarmowego</h1>

  <!-- Kafelki -->
  <div class="row g-4 mb-4">
    <!-- Status -->
    <div class="col-md-4">
      <div class="card shadow-sm h-100 {% if status == 'Uzbrojony' %}bg-warning text-dark{% else %}bg-success text-white{% endif %}">
        <div class="card-body d-flex flex-column align-items-start">
          <h5 class="card-title"><i class="bi bi-shield-lock me-2"></i>Status systemu</h5>
          <p class="fs-5 mb-0">{{ status }}</p>
        </div>
      </div>
    </div>

    <!-- Nieudane próby -->
    <div class="col-md-4">
      <div class="card shadow-sm h-100 {% if failed_attempts|length > 0 %}bg-danger text-white{% else %}bg-success text-white{% endif %}">
        <div class="card-body d-flex flex-column align-items-start">
          <h5 class="card-title"><i class="bi bi-x-circle me-2"></i>Nieudane próby</h5>
          <p class="fs-5 mb-0">{{ failed_attempts|length }}</p>
        </div>
      </div>
    </div>

    <!-- Odwiedziny -->
    <div class="col-md-4">
      <div class="card shadow-sm h-100 bg-primary text-white">
        <div class="card-body d-flex flex-column align-items-start">
          <h5 class="card-title"><i class="bi bi-people me-2"></i>Odwiedziny panelu</h5>
          <p class="fs-5 mb-0">{{ visits }}</p>
        </div>
      </div>
    </div>

    <!-- Ostatni alarm -->
    <div class="col-md-6">
      <div class="card shadow-sm h-100 {% if last_alarm %}bg-danger text-white{% elif failed_attempts %}bg-secondary text-white{% else %}bg-secondary text-white{% endif %}">
        <div class="card-body d-flex flex-column align-items-start">
          <h5 class="card-title"><i class="bi bi-bell me-2"></i>Ostatni alarm</h5>
          {% if last_alarm %}
            <p class="fs-6 mb-0">{{ last_alarm }}</p>
          {% else %}
            <p class="mb-0">Brak alarmów</p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Pobierz log -->
    <div class="col-md-6">
      <div class="card shadow-sm h-100 bg-info text-white">
        <div class="card-body d-flex flex-column align-items-start">
          <h5 class="card-title"><i class="bi bi-download me-2"></i>Pobierz log</h5>
          <a href="{{ url_for('download_log') }}" class="btn btn-light btn-sm mt-2">
            <i class="bi bi-file-earmark-text"></i> Pobierz log.txt
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabela -->
  <h2 class="h5 mb-3"><i class="bi bi-list-ul me-2"></i>Ostatnie próby</h2>
  {% if failed_attempts %}
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>#</th>
            <th>Data</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for attempt in failed_attempts %}
            <tr>
              <th>{{ loop.index }}</th>
              <td>{{ attempt }}</td>
              <td><span class="badge bg-danger"><i class="bi bi-x-circle"></i> Błąd</span></td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-success"><i class="bi bi-check-circle"></i> Brak nieudanych prób 🎉</div>
  {% endif %}
{% endblock %}
